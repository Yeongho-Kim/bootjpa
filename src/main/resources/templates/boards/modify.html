<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" content="${_csrf.token}"/>
<meta name="_csrf_header" content="${_csrf.headerName}"/>
<div th:insert="~{fragment/header::header}"></div>

<div class="container" id="main">
    <div class="col-md-12 col-sm-12 col-lg-10 col-lg-offset-1">
        <div class="panel panel-default content-main">
            <form id="f1" action="/boards/modify" method="post">
                <div class="form-group">
                    <label for="bno">제목</label>
                    <input type="text" class="form-control" id="bno" name="bno" th:value="${vo.bno}" th:readonly="readonly">
                </div>
                <div class="form-group">
                    <label for="title">제목</label>
                    <input type="text" class="form-control" id="title" name="title" th:value="${vo.title}">
                </div>
                <div class="form-group">
                    <label for="content">내용</label>
                    <textarea name="content" id="content" rows="5" class="form-control" th:text="${vo.content}"></textarea>
                </div>
                <div class="form-group">
                    <label for="writer">작성자</label>
                    <input name="writer" id="writer" class="form-control" th:value="${vo.writer}" th:readonly="readonly" >
                </div>
                <input type='hidden' name="page" th:value="${pageVO.page}">
                <input type='hidden' name="size" th:value="${pageVO.size}">
                <input type='hidden' name="type" th:value="${pageVO.type}">
                <input type='hidden' name="keyword" th:value="${pageVO.keyword}">

                <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.token}">
                <button type="submit" class="btn btn-warning ">수정</button>
                <a href="#" class="btn btn-danger  delbtn">삭제</a>
                <a th:href="@{ list(page=${pageVO.page},size=${pageVO.size}, type=${pageVO.type}, keyword=${pageVO.keyword},bno = ${vo.bno})}"
                   class="btn btn-primary">목록</a>
            </form>
        </div>
    </div>
</div>
<div th:insert="~{fragment/footer::footer}"></div>
<script th:inline="javascript">
    $(document).ready(function(){
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        var regex = new RegExp("(.*?)\.(exe|sh|zip|alz)$");
        var maxSize = 100*1024*1024; //100MB
        function checkExtension(fileName, fileSize) {
            if (fileSize >= maxSize) {
                alert("파일 사이즈 초과");
                return false;
            }
            if (regex.test(fileName)) {
                alert("해당 종류의 파일은 업로드할 수 없습니다. \n *(.exe/.sh/.zip/.alz)");
                return false;
            }
            return true;
        }
        $("#uploadBtn").on("click", function(e) {
            e.preventDefault();
            var formData = new FormData();
            var inputFile = $("input[name='uploadFile']");
            var files = inputFile[0].files;
            console.log(files);
            //add filedate to formdata
            for (var i = 0; i < files.length; i++) {
                if (!checkExtension(files[i].name, files[i].size)) {
                    return false;
                }
                formData.append("uploadFile", files[i]);
            }
            $.ajax({
                url: '/files/'+[[${vo.bno}]],
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(result){
                    alert("Uploaded");
                },
                error:function (result) {
                    alert("failed");
                },
                beforeSend: function( xhr ) {
                    xhr.setRequestHeader(header, token);
                }
            });
        });
        var formObj = $("#f1");
        $(".delbtn").click(function(){
            formObj.attr("action","delete");
            formObj.attr("method", "post");
            formObj.submit();
        });
        $(".modbtn").click(function(){
            formObj.attr("action","modify");
            formObj.attr("method", "post");
            formObj.submit();
        });
    });
</script>